//2.

#include <stdio.h>
#include <stdlib.h>
#include <unistd.h>
#include <wait.h>
#include <unistd.h>
//#include <sys/types.h>
#define N 5

int main()
{
	srand(time(NULL));
	int pd12[2],pd21[2];

	if(pipe(pd12)!=0)
	{
		perror("Greska pri kreiranju pd12\n");
		//return -1;
		exit(1);
	}
	if(pipe(pd21)!=0)
	{
		perror("Greska pri kreiranju pd21\n");
		//return -1;
		exit(1);
	}
	
	if(fork()!=0)
	{
		close(pd12[0]);
		close(pd21[1]);
		int buffer[N];
		int i;
		printf("Proces roditelj je generisao brojeve: \n");

		for(i=0;i<N;i++)
		{
			buffer[i]=rand()%100;	
			printf("%d ",buffer[i]);
		}

		write(pd12[1],buffer,N*sizeof(int));
		int count=read(pd21[0],buffer,N*sizeof(int));
		printf("\nProces roditelj je dobio %d parnih brojeva od  deteta: \n",count/sizeof(int));
		
		wait(NULL);	
		close(pd12[1]);
		close(pd21[0]);	
		return 0;	
	}
	else
	{
		close(pd12[1]);
		close(pd21[0]);

		int i,j;
		int buffer[N];
		read(pd12[0],buffer,N*sizeof(int));
		j=0;

		for(i=0;i<N;i++)
		{
			if(buffer[i]%2==0)
				buffer[j++]=buffer[i];
		}

		write(pd21[1],buffer,j*sizeof(int));
		close(pd12[0]);
		close(pd21[1]);
		return 0;
	}
}
